# vim: ft=ksh ts=4

function add-share-S-to-links {
	local h sl RL rl
	for h in $(find . -type l); do
		[[ -a $h ]]|| {
			warn "bad link: ^B$h^b"
			continue
		  }
		sl=$(readlink $h);		strip-kdot sl
		[[ $sl == */* ]]||
			sl=${h%/*}/$sl
		RL=$(readlink -f $h)
		rl=$RL;					strip-kdot rl
		[[ $sl == $rl ]]&& continue
		[[ ${sl%/*}S == ${rl%/*} ]]|| {
			warn "^B$h^b isn't that simple."
			continue
		  }
		set -- ln -fs "$RL" "$h"
		notify "$*"
		"$@"
	done 2>&1
}
